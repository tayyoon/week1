<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
    <title>ì˜¤ëŠ˜ì˜ ê³„ì ˆ, ì˜¤ëŠ˜ì˜ ë…¸ë˜</title>

    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/loginstyle.css">



    <script>
        $(document).ready(function () {
        });

        {% if msg %}
            alert("{{ msg }}")
        {% endif %}
        // ['ì¿ í‚¤'ë¼ëŠ” ê°œë…ì— ëŒ€í•´ ì•Œì•„ë´…ì‹œë‹¤]
        // ë¡œê·¸ì¸ì„ êµ¬í˜„í•˜ë©´, ë°˜ë“œì‹œ ì¿ í‚¤ë¼ëŠ” ê°œë…ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        // í˜ì´ì§€ì— ê´€ê³„ì—†ì´ ë¸Œë¼ìš°ì €ì— ì„ì‹œë¡œ ì €ì¥ë˜ëŠ” ì •ë³´ì…ë‹ˆë‹¤. í‚¤:ë°¸ë¥˜ í˜•íƒœ(ë”•ì…”ë„ˆë¦¬ í˜•íƒœ)ë¡œ ì €ì¥ë©ë‹ˆë‹¤.
        // ì¿ í‚¤ê°€ ìˆê¸° ë•Œë¬¸ì—, í•œë²ˆ ë¡œê·¸ì¸í•˜ë©´ ë„¤ì´ë²„ì—ì„œ ë‹¤ì‹œ ë¡œê·¸ì¸í•  í•„ìš”ê°€ ì—†ëŠ” ê²ƒì…ë‹ˆë‹¤.
        // ë¸Œë¼ìš°ì €ë¥¼ ë‹«ìœ¼ë©´ ìë™ ì‚­ì œë˜ê²Œ í•˜ê±°ë‚˜, ì¼ì • ì‹œê°„ì´ ì§€ë‚˜ë©´ ì‚­ì œë˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        function sign_in() {
            $.ajax({
                type: "POST",
                url: "/api/login",
                data: {username_give: $('#userid').val(), password_give: $('#userpw').val()},
                success: function (response) {
                    console.log(response)
                    if (response['result'] == 'success') {
                        $.cookie('mytoken', response['token']);

                        alert('í™˜ì˜í•©ë‹ˆë‹¤ğŸŒ·')
                        window.location.href = '/'
                    } else {
                        alert(response['msg'])
                    }
                }
            })
        }


        //ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸ ì •ê·œ í‘œí˜„ì‹
        function is_nickname(asValue) {
            var regExp = /^(?=.*[a-zA-Z])[-a-zA-Z0-9_.]{2,10}$/;
            return regExp.test(asValue);
        }

        function is_password(asValue) {
            var regExp = /^(?=.*\d)(?=.*[a-zA-Z])[0-9a-zA-Z!@#$%^&*]{8,20}$/;
            return regExp.test(asValue);
        }

        function register() {
            $('#login-box').hide()
            $('#membership-box').show();
        }

        function sign_up() {
            let username = $("#input-username").val()
            let password = $("#input-password").val()
            let password2 = $("#input-password2").val()
            let nickname = $("#input-nickname").val()
            console.log(username, password, password2)

            if ($("#help-id").hasClass("is-danger")) {
                alert("ì•„ì´ë””ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.")
                return;
            } else if (!$("#help-id").hasClass("is-success")) {
                alert("ì•„ì´ë”” ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”.")
                return;
            }

            if (password == "") {
                $("#help-password").text("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.").removeClass("is-safe").addClass("is-danger")
                $("#input-password").focus()
                return;
            } else if (!is_password(password)) {
                $("#help-password").text("ë¹„ë°€ë²ˆí˜¸ì˜ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”. ì˜ë¬¸ê³¼ ìˆ«ì í•„ìˆ˜ í¬í•¨, íŠ¹ìˆ˜ë¬¸ì(!@#$%^&*) ì‚¬ìš©ê°€ëŠ¥ 8-20ì").removeClass("is-safe").addClass("is-danger")
                $("#input-password").focus()
                return
            } else {
                $("#help-password").text("ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.").removeClass("is-danger").addClass("is-success")
            }
            if (password2 == "") {
                $("#help-password2").text("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.").removeClass("is-safe").addClass("is-danger")
                $("#input-password2").focus()
                return;
            } else if (password2 != password) {
                $("#help-password2").text("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.").removeClass("is-safe").addClass("is-danger")
                $("#input-password2").focus()
                return;
            } else {
                $("#help-password2").text("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.").removeClass("is-danger").addClass("is-success")
            }
            $.ajax({
                type: "POST",
                url: "/sign_up/save",
                data: {
                    username_give: username,
                    password_give: password,
                    nickname_give: nickname
                },
                success: function (response) {
                    alert("íšŒì›ê°€ì…ì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤!")
                    window.location.replace("/login")
                }
            });
        }

        function check_dup() {
            let username = $("#input-username").val()
            console.log(username)
            if (username == "") {
                $("#help-id").text("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.").removeClass("is-safe").addClass("is-danger")
                $("#input-username").focus()
                return;
            }
            if (!is_nickname(username)) {
                $("#help-id").text("ì•„ì´ë””ì˜ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”. ì˜ë¬¸ê³¼ ìˆ«ì, ì¼ë¶€ íŠ¹ìˆ˜ë¬¸ì(._-) ì‚¬ìš© ê°€ëŠ¥. 2-10ì ê¸¸ì´").removeClass("is-safe").addClass("is-danger")
                $("#input-username").focus()
                return;
            }
            $("#help-id").addClass("is-loading")
            $.ajax({
                type: "POST",
                url: "/sign_up/check_dup",
                data: {
                    username_give: username
                },
                success: function (response) {
                    if (response["exists"]) {
                        $("#help-id").text("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.").removeClass("is-safe").addClass("is-danger")
                        $("#input-username").focus()
                    } else {
                        $("#help-id").text("ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.").removeClass("is-danger").addClass("is-success")
                    }
                    $("#help-id").removeClass("is-loading")

                }
            });
        }

    </script>
</head>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
// ì¿ í‚¤ê°€ ìë°”ìŠ¤í¬ë¦¼íŠ¸(ì œì´ì¿¼ë¦¬)ì—ì„œ ëŒ ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ìŠ¤í¬ë¦½íŠ¸
// ì—†ì„ê²½ìš° ë¬¸í¬ë‹˜ì´ ì£¼ì„ì²˜ë¦¬ í•´ë‘” ë¶€ë¶„ì´ ì‹¤í–‰ì´ ë˜ì§€ ì•ŠìŒ.(í† í°,ì¿ í‚¤ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ê°€ ì—†ìŒ)
<body>
<div class="hpid" id="signup-box">
    <div class="mytitle">
        <h1>ì˜¤ëŠ˜ì˜ ê³„ì ˆ, ì˜¤ëŠ˜ì˜ ë…¸ë˜ </h1>
    </div>
    <div class="login" id='login-box' style="max-width: 540px;">
        <h3 class="logti">ë¡œê·¸ì¸</h3>
        <input id="userid" class="form-control form-control-lg" type="text" placeholder="ì•„ì´ë””" aria-label="ì•„ì´ë””">
        <div style="height:15px;"></div>
        <input id="userpw" class="form-control form-control-lg" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" aria-label="ë¹„ë°€ë²ˆí˜¸">
        <div style="height:15px;"></div>
        <div class="btns">
            <button onclick='sign_in()' type="button" class="btn btn-outline-light">ì…ì¥í•˜ê¸°</button>
            <button onclick='register()' id="member" type="button" class="btn btn-outline-light">íšŒì›ê°€ì…</button>
        </div>
    </div>


    <!--    íšŒì›ê°€ì… í™”ë©´  -->
    <div class="membership-box" id='membership-box'>
        <h3 style="text-align: center">íšŒì›ê°€ì…</h3>
        <div style="height:15px;"></div>
        <form class="form-inline" role="form">
            <div>
                <input id="input-username" class="form-control form-control-sm"
                       style="width: 80%; display:inline-block;" type="text" placeholder="ì•„ì´ë””">
                <button onclick="check_dup()" type="button" class="btn btn-outline-light" style="font-size: 0.7em">
                    ì¤‘ë³µí™•ì¸
                </button>
            </div>
            <p id="help-id" class="help is-hidden" style="font-size: 0.5em;">ì•„ì´ë””ëŠ” 2-10ìì˜ ì˜ë¬¸ê³¼ ìˆ«ìì™€ ì¼ë¶€ íŠ¹ìˆ˜ë¬¸ì(._-)ë§Œ
                ì…ë ¥ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
            <p id="help-id-login" class="help is-danger"></p>


            <input id="input-password" class="form-control form-control-sm " type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"
                   aria-label="password">
            <span class="icon is-small is-left"><i class="fa fa-lock"></i></span>
            <p id="help-password" style="font-size: 0.5em;" class="help is-hidden">ì˜ë¬¸ê³¼ ìˆ«ì,íŠ¹ìˆ˜ë¬¸ì(!@#$%^&*) ì¡°í•©ì˜ 8-20ìì˜
                ë¹„ë°€ë²ˆí˜¸ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.</p>
            <p id="help-password-login" class="help is-danger"></p>


            <input id="input-password2" class="form-control form-control-sm" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥"
                   aria-label="password">
            <p id="help-password2" style="font-size: 0.5em;" class="help is-hidden">ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í•œ ë²ˆ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>

            <input id="input-nickname" class="form-control form-control-sm" type="text" placeholder="ë‹‰ë„¤ì„"
                   aria-label="password">
            <div class="btns">
                <button onclick='sign_up()' type="button" class="btn btn-light">íšŒì›ê°€ì…</button>
                <button onclick="location.href='/'" type="button" class="btn btn-outline-light">ì·¨ì†Œ</button>
            </div>
        </form>
    </div>

</div>
</body>
</html>